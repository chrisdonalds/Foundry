/*
 * FancyBox - jQuery Plugin
 * Simple and fancy lightbox alternative
 *
 * Examples and documentation at: http://fancybox.net
 * 
 * Copyright (c) 2008 - 2010 Janis Skarnelis
 *
 * Version: 1.3.1 (05/03/2010)
 * Requires: jQuery v1.3+
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(n){var F,N,L,G,d,t,E,J,w,z=0,D={},g=[],e=0,B={},v=[],f=null,m,H=1,a,c,K=false,y=20,q=n.extend(n("<div/>")[0],{prop:0}),i=0,M=!n.support.opacity&&!window.XMLHttpRequest,h=function(){N.hide();if(f){f.abort()}F.empty()},l=function(){n.fancybox('<p id="fancybox_error">The requested content cannot be loaded.<br />Please try again later.</p>',{scrolling:"no",padding:20,transitionIn:"none",transitionOut:"none"})},A=function(){return[n(window).width(),n(window).height(),n(document).scrollLeft(),n(document).scrollTop()]},b=function(){var P=A(),W={},U=B.margin,Q=B.autoScale,V=(y+U)*2,T=(y+U)*2,R=(B.padding*2),S;if(B.width.toString().indexOf("%")>-1){W.width=((P[0]*parseFloat(B.width))/100)-(y*2);Q=false}else{W.width=B.width+R}if(B.height.toString().indexOf("%")>-1){W.height=((P[1]*parseFloat(B.height))/100)-(y*2);Q=false}else{W.height=B.height+R}if(Q&&(W.width>(P[0]-V)||W.height>(P[1]-T))){if(D.type=="image"||D.type=="swf"){V+=R;T+=R;S=Math.min(Math.min(P[0]-V,B.width)/B.width,Math.min(P[1]-T,B.height)/B.height);W.width=Math.round(S*(W.width-R))+R;W.height=Math.round(S*(W.height-R))+R}else{W.width=Math.min(W.width,(P[0]-V));W.height=Math.min(W.height,(P[1]-T))}}W.top=P[3]+((P[1]-(W.height+(y*2)))*0.5);W.left=P[2]+((P[0]-(W.width+(y*2)))*0.5);if(B.autoScale===false){W.top=Math.max(P[3]+U,W.top);W.left=Math.max(P[2]+U,W.left)}return W},I=function(P){if(P&&P.length){switch(B.titlePosition){case"inside":return P;case"over":return'<span id="fancybox-title-over">'+P+"</span>";default:return'<span id="fancybox-title-wrap"><span id="fancybox-title-left"></span><span id="fancybox-title-main">'+P+'</span><span id="fancybox-title-right"></span></span>'}}return false},p=function(){var R=B.title,Q=c.width-(B.padding*2),P="fancybox-title-"+B.titlePosition;n("#fancybox-title").remove();i=0;if(B.titleShow===false){return}R=n.isFunction(B.titleFormat)?B.titleFormat(R,v,e,B):I(R);if(!R||R===""){return}n('<div id="fancybox-title" class="'+P+'" />').css({width:Q,paddingLeft:B.padding,paddingRight:B.padding}).html(R).appendTo("body");switch(B.titlePosition){case"inside":i=n("#fancybox-title").outerHeight(true)-B.padding;c.height+=i;break;case"over":n("#fancybox-title").css("bottom",B.padding);break;default:n("#fancybox-title").css("bottom",n("#fancybox-title").outerHeight(true)*-1);break}n("#fancybox-title").appendTo(d).hide()},s=function(){t.css("overflow",(B.scrolling=="auto"?(B.type=="image"||B.type=="iframe"||B.type=="swf"?"hidden":"auto"):(B.scrolling=="yes"?"auto":"visible")));if(!n.support.opacity){t.get(0).style.removeAttribute("filter");G.get(0).style.removeAttribute("filter")}n("#fancybox-title").show();if(B.hideOnContentClick){t.one("click",n.fancybox.close)}if(B.hideOnOverlayClick){L.one("click",n.fancybox.close)}if(B.showCloseButton){E.show()}n(window).bind("resize.fb",n.fancybox.center);if(B.centerOnScroll){n(window).bind("scroll.fb",n.fancybox.center)}else{n(window).unbind("scroll.fb")}if(n.isFunction(B.onComplete)){B.onComplete(v,e,B)}K=false},C=function(T){var Q=Math.round(a.width+(c.width-a.width)*T),P=Math.round(a.height+(c.height-a.height)*T),S=Math.round(a.top+(c.top-a.top)*T),R=Math.round(a.left+(c.left-a.left)*T);G.css({width:Q+"px",height:P+"px",top:S+"px",left:R+"px"});Q=Math.max(Q-B.padding*2,0);P=Math.max(P-(B.padding*2+(i*T)),0);t.css({width:Q+"px",height:P+"px"});if(typeof c.opacity!=="undefined"){G.css("opacity",(T<0.5?0.5:T))}},u=function(P){var Q=P.offset();Q.top+=parseFloat(P.css("paddingTop"))||0;Q.left+=parseFloat(P.css("paddingLeft"))||0;Q.top+=parseFloat(P.css("border-top-width"))||0;Q.left+=parseFloat(P.css("border-left-width"))||0;Q.width=P.width();Q.height=P.height();return Q},O=function(){var S=D.orig?n(D.orig):false,R={},Q,P;if(S&&S.length){Q=u(S);R={width:(Q.width+(B.padding*2)),height:(Q.height+(B.padding*2)),top:(Q.top-B.padding-y),left:(Q.left-B.padding-y)}}else{P=A();R={width:1,height:1,top:P[3]+P[1]*0.5,left:P[2]+P[0]*0.5}}return R},r=function(){N.hide();if(G.is(":visible")&&n.isFunction(B.onCleanup)){if(B.onCleanup(v,e,B)===false){n.event.trigger("fancybox-cancel");K=false;return}}v=g;e=z;B=D;t.get(0).scrollTop=0;t.get(0).scrollLeft=0;if(B.overlayShow){if(M){n("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden"}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"})}L.css({"background-color":B.overlayColor,opacity:B.overlayOpacity}).unbind().show()}c=b();p();if(G.is(":visible")){n(E.add(J).add(w)).hide();var Q=G.position(),P;a={top:Q.top,left:Q.left,width:G.width(),height:G.height()};P=(a.width==c.width&&a.height==c.height);t.fadeOut(B.changeFade,function(){var R=function(){t.html(F.contents()).fadeIn(B.changeFade,s)};n.event.trigger("fancybox-change");t.empty().css("overflow","hidden");if(P){t.css({top:B.padding,left:B.padding,width:Math.max(c.width-(B.padding*2),1),height:Math.max(c.height-(B.padding*2)-i,1)});R()}else{t.css({top:B.padding,left:B.padding,width:Math.max(a.width-(B.padding*2),1),height:Math.max(a.height-(B.padding*2),1)});q.prop=0;n(q).animate({prop:1},{duration:B.changeSpeed,easing:B.easingChange,step:C,complete:R})}});return}G.css("opacity",1);if(B.transitionIn=="elastic"){a=O();t.css({top:B.padding,left:B.padding,width:Math.max(a.width-(B.padding*2),1),height:Math.max(a.height-(B.padding*2),1)}).html(F.contents());G.css(a).show();if(B.opacity){c.opacity=0}q.prop=0;n(q).animate({prop:1},{duration:B.speedIn,easing:B.easingIn,step:C,complete:s})}else{t.css({top:B.padding+2,left:B.padding+2,width:Math.max(c.width-(B.padding*2),1),height:Math.max(c.height-(B.padding*2)-i,1)}).html(F.contents());G.css(c).fadeIn(B.transitionIn=="none"?0:B.speedIn,s)}},o=function(){F.width(D.width);F.height(D.height);if(D.width=="auto"){D.width=F.width()}if(D.height=="auto"){D.height=F.height()}r()},j=function(){h();var U=g[z],R,S,W,V,Q,P,T;D=n.extend({},n.fn.fancybox.defaults,(typeof n(U).data("fancybox")=="undefined"?D:n(U).data("fancybox")));W=U.title||n(U).title||D.title||"";if(U.nodeName&&!D.orig){D.orig=n(U).children("img:first").length?n(U).children("img:first"):n(U)}if(W===""&&D.orig){W=D.orig.attr("alt")}if(U.nodeName&&(/^(?:javascript|#)/i).test(U.href)){R=D.href||null}else{R=D.href||U.href||null}if(D.type){S=D.type;if(!R){R=D.content}}else{if(D.content){S="html"}else{if(R){if(n(U).hasClass("iframe")){S="iframe"}else{if(R.match(/#/)){U=R.substr(R.indexOf("#"));S=n(U).length>0?"inline":"ajax"}else{S="ajax"}}}else{S="inline"}}}D.type=S;D.href=R;if(D.autoDimensions&&D.type!=="iframe"&&D.type!=="swf"){D.width="auto";D.height="auto"}if(D.modal){D.overlayShow=true;D.hideOnOverlayClick=false;D.hideOnContentClick=false;D.enableEscapeButton=false;D.showCloseButton=false}if(n.isFunction(D.onStart)){if(D.onStart(g,z,D)===false){K=false;return}}F.css("padding",(y+D.padding+D.margin));n(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){n(this).replaceWith(t.children())});switch(S){case"html":F.html(D.content);o();break;case"inline":n('<div class="fancybox-inline-tmp" />').hide().insertBefore(n(U)).bind("fancybox-cleanup",function(){n(this).replaceWith(t.children())}).bind("fancybox-cancel",function(){n(this).replaceWith(F.children())});n(U).appendTo(F);o();break}},k=function(){if(!N.is(":visible")){clearInterval(m);return}n("div",N).css("top",(H*-40)+"px");H=(H+1)%12},x=function(){if(n("#fancybox-wrap").length){return}n("body").append(F=n('<div id="fancybox-tmp"></div>'),N=n('<div id="fancybox-loading"><div></div></div>'),L=n('<div id="fancybox-overlay"></div>'),G=n('<div id="fancybox-wrap"></div>'));if(!n.support.opacity){G.addClass("fancybox-ie");N.addClass("fancybox-ie")}d=n('<div id="fancybox-outer"></div>').append('<div class="fancy-bg" id="fancy-bg-n"></div><div class="fancy-bg" id="fancy-bg-ne"></div><div class="fancy-bg" id="fancy-bg-e"></div><div class="fancy-bg" id="fancy-bg-se"></div><div class="fancy-bg" id="fancy-bg-s"></div><div class="fancy-bg" id="fancy-bg-sw"></div><div class="fancy-bg" id="fancy-bg-w"></div><div class="fancy-bg" id="fancy-bg-nw"></div>').appendTo(G);d.append(t=n('<div id="fancybox-inner"></div>'),E=n('<a id="fancybox-close"></a>'),J=n('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),w=n('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));E.click(n.fancybox.close);N.click(n.fancybox.cancel);if(M){L.get(0).style.setExpression("height","document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + 'px'");N.get(0).style.setExpression("top","(-20 + (document.documentElement.clientHeight ? document.documentElement.clientHeight/2 : document.body.clientHeight/2 ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop )) + 'px'");d.prepend('<iframe id="fancybox-hide-sel-frame" src="javascript:\'\';" scrolling="no" frameborder="0" ></iframe>')}};n.fn.fancybox=function(P){n(this).data("fancybox",n.extend({},P,(n.metadata?n(this).metadata():{}))).unbind("click.fb").bind("click.fb",function(R){R.preventDefault();if(K){return}K=true;n(this).blur();g=[];z=0;var Q=n(this).attr("rel")||"";if(!Q||Q==""||Q==="nofollow"){g.push(this)}else{g=n("a[rel="+Q+"], area[rel="+Q+"]");z=g.index(this)}j();return false});return this};n.fancybox=function(S){if(K){return}K=true;var R=typeof arguments[1]!=="undefined"?arguments[1]:{};g=[];z=R.index||0;if(n.isArray(S)){for(var Q=0,P=S.length;Q<P;Q++){if(typeof S[Q]=="object"){n(S[Q]).data("fancybox",n.extend({},R,S[Q]))}else{S[Q]=n({}).data("fancybox",n.extend({content:S[Q]},R))}}g=n.merge(g,S)}else{if(typeof S=="object"){n(S).data("fancybox",n.extend({},R,S))}else{S=n({}).data("fancybox",n.extend({content:S},R))}g.push(S)}if(z>g.length||z<0){z=0}j()};n.fancybox.showActivity=function(){clearInterval(m);N.show();m=setInterval(k,66)};n.fancybox.hideActivity=function(){N.hide()};n.fancybox.pos=function(P){if(K){return}P=parseInt(P,10);if(P>-1&&v.length>P){z=P;j()}if(B.cyclic&&v.length>1&&P<0){z=v.length-1;j()}if(B.cyclic&&v.length>1&&P>=v.length){z=0;j()}return};n.fancybox.cancel=function(){if(K){return}K=true;n.event.trigger("fancybox-cancel");h();if(D&&n.isFunction(D.onCancel)){D.onCancel(g,z,D)}K=false};n.fancybox.close=function(){if(K||G.is(":hidden")){return}K=true;if(B&&n.isFunction(B.onCleanup)){if(B.onCleanup(v,e,B)===false){K=false;return}}h();n(E.add(J).add(w)).hide();n("#fancybox-title").remove();G.add(t).add(L).unbind();n(window).unbind("resize.fb scroll.fb");n(document).unbind("keydown.fb");function P(){L.fadeOut("fast");G.hide();n.event.trigger("fancybox-cleanup");t.empty();if(n.isFunction(B.onClosed)){B.onClosed(v,e,B)}v=D=[];e=z=0;B=D={};K=false}t.css("overflow","hidden");if(B.transitionOut=="elastic"){a=O();var Q=G.position();c={top:Q.top,left:Q.left,width:G.width(),height:G.height()};if(B.opacity){c.opacity=1}q.prop=1;n(q).animate({prop:0},{duration:B.speedOut,easing:B.easingOut,step:C,complete:P})}else{G.fadeOut(B.transitionOut=="none"?0:B.speedOut,P)}};n.fancybox.resize=function(){var Q,P;if(K||G.is(":hidden")){return}K=true;Q=t.wrapInner("<div style='overflow:auto'></div>").children();P=Q.height();G.css({height:P+(B.padding*2)+i});t.css({height:P});Q.replaceWith(Q.children());n.fancybox.center()};n.fancybox.center=function(){K=true;var P=A(),Q=B.margin,R={};R.top=P[3]+((P[1]-((G.height()-i)+(y*2)))*0.5);R.left=P[2]+((P[0]-(G.width()+(y*2)))*0.5);R.top=Math.max(P[3]+Q,R.top);R.left=Math.max(P[2]+Q,R.left);G.css(R);K=false};n.fn.fancybox.defaults={padding:10,margin:20,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.3,overlayColor:"#666",titleShow:true,titlePosition:"outside",titleFormat:null,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:false,enableEscapeButton:true,onStart:null,onCancel:null,onComplete:null,onCleanup:null,onClosed:null};n.fancybox.init=function(){x()}})(jQuery);